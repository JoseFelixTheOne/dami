package com.dawi.controller;

import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;

import com.dawi.models.Persona;
import com.dawi.models.Usuario;
import com.dawi.repository.IUsuarioRepository;

@Controller
public class LoginController {

	
	@Autowired
	private IUsuarioRepository usuarioRepo;
	
	@GetMapping("/")
	public String login(Model model) {
		return "login";
	}
	
	@PostMapping("/")
	public String loginUser(@RequestParam(name = "usuario")String usuario ,
			@RequestParam(name = "contra")String contra ) {
		boolean exito=encontroUsuario(usuario,contra);
		if(exito==true) {
			return "index";
		}
		return "/login";
	}
	
	private boolean encontroUsuario(String nombreusuario,String contra) {
		boolean exito=false;
		var usuarios=usuarioRepo.findAll();
		for (Usuario usuario : usuarios) {
			if(usuario.getActivo_usu().equals("a") && usuario.getOpersona().getActivo_per().equals("a")
					&& usuario.getNom_usu().equals(nombreusuario) 
					&& usuario.getContra_usu().equals(contra)
					) {
				exito=true;break;
			}
		}
		return exito;
	}
	
	
}
